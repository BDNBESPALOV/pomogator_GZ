<?xml version="1.0" encoding="UTF-8"?>
<report xmlns="http://www.eclipse.org/birt/2005/design" version="3.2.23" id="1">
    <property name="createdBy">Eclipse BIRT Designer Version 3.7.2.v20120213 Build &lt;3.7.2.v20120214-1408></property>
    <property name="units">in</property>
    <property name="iconFile">/templates/blank_report.gif</property>
    <property name="layoutPreference">auto layout</property>
    <property name="bidiLayoutOrientation">ltr</property>
    <property name="imageDPI">96</property>
    <parameters>
        <scalar-parameter name="MIN" id="9">
            <text-property name="promptText">Дата1</text-property>
            <property name="valueType">static</property>
            <property name="dataType">date</property>
            <property name="distinct">true</property>
            <simple-property-list name="defaultValue">
                <value type="constant">2018-01-01</value>
            </simple-property-list>
            <list-property name="selectionList"/>
            <property name="paramType">simple</property>
            <property name="controlType">text-box</property>
            <structure name="format">
                <property name="category">Unformatted</property>
            </structure>
        </scalar-parameter>
        <scalar-parameter name="MAX" id="10">
            <text-property name="promptText">Дата2</text-property>
            <property name="valueType">static</property>
            <property name="dataType">date</property>
            <property name="distinct">true</property>
            <simple-property-list name="defaultValue">
                <value type="constant">2018-12-31</value>
            </simple-property-list>
            <list-property name="selectionList"/>
            <property name="paramType">simple</property>
            <property name="controlType">text-box</property>
            <structure name="format">
                <property name="category">Unformatted</property>
            </structure>
        </scalar-parameter>
        <scalar-parameter name="CUST_ID" id="1383">
            <property name="valueType">static</property>
            <property name="isRequired">false</property>
            <property name="dataType">string</property>
            <property name="distinct">true</property>
            <simple-property-list name="defaultValue">
                <value type="constant">86213</value>
            </simple-property-list>
            <list-property name="selectionList"/>
            <property name="paramType">simple</property>
            <property name="controlType">text-box</property>
            <structure name="format">
                <property name="category">Unformatted</property>
            </structure>
        </scalar-parameter>
    </parameters>
    <data-sources>
        <oda-data-source extensionID="org.eclipse.birt.report.data.oda.jdbc" name="Data Source" id="7">
            <list-property name="privateDriverProperties">
                <ex-property>
                    <name>metadataBidiFormatStr</name>
                    <value>ILYNN</value>
                </ex-property>
                <ex-property>
                    <name>disabledMetadataBidiFormatStr</name>
                </ex-property>
                <ex-property>
                    <name>contentBidiFormatStr</name>
                    <value>ILYNN</value>
                </ex-property>
                <ex-property>
                    <name>disabledContentBidiFormatStr</name>
                </ex-property>
            </list-property>
            <property name="odaDriverClass">oracle.jdbc.driver.OracleDriver</property>
            <property name="odaURL">jdbc:oracle:thin:@localhost:1523:azk</property>
            <property name="odaUser">STEND_GZ_BELGOBL1</property>
            <encrypted-property name="odaPassword" encryptionID="base64">U1RFTkRfR1pfQkVMR09CTDE=</encrypted-property>
        </oda-data-source>
        <oda-data-source extensionID="org.eclipse.birt.report.data.oda.jdbc" name="Real_GZ_BELGOBL1" id="1776">
            <list-property name="privateDriverProperties">
                <ex-property>
                    <name>metadataBidiFormatStr</name>
                    <value>ILYNN</value>
                </ex-property>
                <ex-property>
                    <name>disabledMetadataBidiFormatStr</name>
                </ex-property>
                <ex-property>
                    <name>contentBidiFormatStr</name>
                    <value>ILYNN</value>
                </ex-property>
                <ex-property>
                    <name>disabledContentBidiFormatStr</name>
                </ex-property>
            </list-property>
            <property name="odaDriverClass">oracle.jdbc.OracleDriver</property>
            <property name="odaURL">jdbc:oracle:thin:@localhost:1523:azk</property>
            <property name="odaUser">GZ_BELGOBL1</property>
            <encrypted-property name="odaPassword" encryptionID="base64">R1pfQkVMR09CTDE=</encrypted-property>
        </oda-data-source>
    </data-sources>
    <data-sets>
        <oda-data-set extensionID="org.eclipse.birt.report.data.oda.jdbc.JdbcSelectDataSet" name="test" id="1780">
            <property name="nullsOrdering">nulls lowest</property>
            <list-property name="parameters">
                <structure>
                    <property name="name">param_2</property>
                    <property name="paramName">MIN</property>
                    <property name="dataType">date</property>
                    <property name="position">1</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_3</property>
                    <property name="paramName">MAX</property>
                    <property name="dataType">date</property>
                    <property name="position">2</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_6</property>
                    <property name="paramName">MIN</property>
                    <property name="dataType">date</property>
                    <property name="position">3</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_7</property>
                    <property name="paramName">MAX</property>
                    <property name="dataType">date</property>
                    <property name="position">4</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_10</property>
                    <property name="paramName">MIN</property>
                    <property name="dataType">date</property>
                    <property name="position">5</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_11</property>
                    <property name="paramName">MAX</property>
                    <property name="dataType">date</property>
                    <property name="position">6</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_13</property>
                    <property name="paramName">MIN</property>
                    <property name="dataType">date</property>
                    <property name="position">7</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_14</property>
                    <property name="paramName">MAX</property>
                    <property name="dataType">date</property>
                    <property name="position">8</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_1</property>
                    <property name="paramName">MIN</property>
                    <property name="dataType">date</property>
                    <property name="position">9</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_4</property>
                    <property name="paramName">MAX</property>
                    <property name="dataType">date</property>
                    <property name="position">10</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_5</property>
                    <property name="paramName">MIN</property>
                    <property name="dataType">date</property>
                    <property name="position">11</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_8</property>
                    <property name="paramName">MAX</property>
                    <property name="dataType">date</property>
                    <property name="position">12</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
            </list-property>
            <structure name="cachedMetaData">
                <list-property name="resultSet">
                    <structure>
                        <property name="position">1</property>
                        <property name="name">COSTNAME</property>
                        <property name="dataType">string</property>
                    </structure>
                    <structure>
                        <property name="position">2</property>
                        <property name="name">ITOG_SUM_P</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">3</property>
                        <property name="name">ITOG_SUM_PO</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">4</property>
                        <property name="name">ITOG_SUMM_PP</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">5</property>
                        <property name="name">P5</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">6</property>
                        <property name="name">CUSTOMER_ID</property>
                        <property name="dataType">decimal</property>
                    </structure>
                </list-property>
            </structure>
            <property name="dataSource">Real_GZ_BELGOBL1</property>
            <list-property name="resultSet">
                <structure>
                    <property name="position">1</property>
                    <property name="name">COSTNAME</property>
                    <property name="nativeName">COSTNAME</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">2</property>
                    <property name="name">ITOG_SUM_P</property>
                    <property name="nativeName">ITOG_SUM_P</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">3</property>
                    <property name="name">ITOG_SUM_PO</property>
                    <property name="nativeName">ITOG_SUM_PO</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">4</property>
                    <property name="name">ITOG_SUMM_PP</property>
                    <property name="nativeName">ITOG_SUMM_PP</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">5</property>
                    <property name="name">P5</property>
                    <property name="nativeName">P5</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">6</property>
                    <property name="name">CUSTOMER_ID</property>
                    <property name="nativeName">CUSTOMER_ID</property>
                    <property name="dataType">decimal</property>
                </structure>
            </list-property>
            <xml-property name="queryText"><![CDATA[WITH Inc_Out AS 
(
select f.document_id from docflag f where f.docflagtype_id in (213,214,307)
),


Inc_Out_PURCHASEMODE_CAPTION AS (
  select id from contractdoc where (PURCHASEMODE_CAPTION in ('Открытый конкурс','Запрос котировок',
'Электронный аукцион','Конкурс с ограниченным участием','Двухэтапный конкурс','Запрос предложений','Открытый конкурс в электронной форме',
'Открытый конкурс с ограниченным участием в электронной форме','Двухэтапный конкурс в электронной форме','Запрос котировок в электронной форме','Запрос предложений в электронной форме','Аукцион в электронной форме')
or (DESCRIPTION like '%Статья 93%' and DESCRIPTION like '%п.25%')
)
), 

Inc_Out_PURCHASEMODE__115 AS (
  select id from contractdoc where (PURCHASEMODE_CAPTION in ('Открытый конкурс','Запрос котировок',
'Электронный аукцион','Конкурс с ограниченным участием','Двухэтапный конкурс','Запрос предложений','Открытый конкурс в электронной форме',
'Открытый конкурс с ограниченным участием в электронной форме','Двухэтапный конкурс в электронной форме','Запрос котировок в электронной форме','Запрос предложений в электронной форме','Аукцион в электронной форме')

or (DESCRIPTION like '%Статья 93%' and DESCRIPTION like '%п.25%' and document_id  in (select f.document_id from docflag f , docflagtype ft where f.docflagtype_id=ft.id  and f.docflagtype_id in (115)) 
and PURCHASEMODE_CAPTION in ('Закупка у единственного поставщика (исполнителя, подрядчика)'))

)
),

Inc_Out_docflag AS (
select f.document_id from docflag f where f.docflagtype_id in (115)
),

Inc_Out_docflag_227 AS (
select f.document_id from docflag f where f.docflagtype_id in (227)
)



select  (select description from org where id=C.customer_id ) as costname, C.itog_Sum_P ,   D.itog_Sum_PO, itog_Summ_Pp, (  100 * (itog_Sum_PO + 
(
case  when EXISTS (select * from dual where itog_Summ_Pp is null ) then 0 else itog_Summ_Pp end
)
) / itog_Sum_P ) as p5, C.customer_id  from 
 
 
 -------------СССССССССССССССССССССССССССССССССССССССССССССССССССССССССССС
 (
select sum(sum_amoun_P) as itog_Sum_P, customer_id  from (

select sum(sum_amoun_pay) as sum_amoun_P,paydate,contract_id,doc_number,status,kod,customer_id from (

select sum(amount) as sum_amoun_pay,paydate,contract_id from CONPAYFACT where contract_id in 
(select id from contractdoc where id in (  select id from Inc_Out_PURCHASEMODE__115 )  and document_id not in (select document_id from Inc_Out )
   
and dispstatus_id not in (-1,11,24,7,9) ) and paydate  BETWEEN ? AND ?   group by paydate,contract_id
) A join 

(

select co.id, co.doc_number, (select caption from DISPSTATUS where co.DISPSTATUS_ID=id) as status, (select code from CONTRACTREASON where id=co.SINGLECUSTOMERREASON_ID)as kod 
, customer_id from contractdoc co
JOIN BUDGET bydget
 ON co.BUDGET_ID = bydget.Id  
 
 where  co.id in ( select id from Inc_Out_PURCHASEMODE__115 ) and document_id not in (select document_id from Inc_Out )
  and bydget.caption not like '%223%' and co.DocumentClass_Id = 32
     and co.dispstatus_id not in (-1,11,24,7,9) 
  and co.id in (select contract_id from CONPAYFACT where contract_id in (select id from contractdoc where  id in ( select id from Inc_Out_PURCHASEMODE__115 ) and document_id not in (select document_id from Inc_Out )
 
and dispstatus_id not in (-1,11,24,7,9)
) and paydate  BETWEEN ? AND ?   group by paydate,contract_id)
) B
on A.contract_id = B.id group by A.contract_id,paydate,contract_id,doc_number,status,kod,customer_id ) 
group by customer_id
) C join 
-------------СССССССССССССССССССССССССССССССССССССССССССССССССССССССССССС
-------------DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD
(
select sum(sum_amoun_P_o) as itog_Sum_PO, customer_id from (

select sum(sum_amoun_pay) as sum_amoun_P_o,paydate,contract_id,doc_number,status,kod,customer_id from 

(
select co.id, co.doc_number, (select caption from DISPSTATUS where co.DISPSTATUS_ID=id) as status, (select code from CONTRACTREASON where id=co.SINGLECUSTOMERREASON_ID)as kod 
,customer_id from contractdoc co
JOIN BUDGET bydget
 ON co.BUDGET_ID = bydget.Id  
  where co.id in ( select id from Inc_Out_PURCHASEMODE_CAPTION) and document_id not in (select document_id from Inc_Out )
and document_id  in (select  document_id from Inc_Out_docflag)

  and bydget.caption not like '%223%'
  and co.DocumentClass_Id = 32  and co.dispstatus_id not in (-1,11,24,7,9) 
  and co.id in (select contract_id from CONPAYFACT where contract_id in (select id from contractdoc where id in ( select id from Inc_Out_PURCHASEMODE_CAPTION) and document_id not in (select document_id from Inc_Out )
and document_id in (select  document_id from Inc_Out_docflag)

and dispstatus_id not in (-1,11,24,7,9)
) and paydate  BETWEEN ? AND ? )
) A join 
(
select sum(amount) as sum_amoun_pay,paydate,contract_id from CONPAYFACT where contract_id in (select id from contractdoc where id in ( select id from Inc_Out_PURCHASEMODE_CAPTION ) and document_id not in (select document_id from Inc_Out )
and document_id in (select  document_id from Inc_Out_docflag)

and dispstatus_id not in (-1,11,24,7,9)
) and paydate  BETWEEN ? AND ?  group by paydate,contract_id
) B on A.id=B.contract_id  group by paydate,contract_id,doc_number,status,kod,customer_id ) group by customer_id

) D on C.customer_id = D.customer_id  
-------------DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD

left join 
(
select sum(sum_amoun_P_p) as itog_Summ_Pp, customer_id from (
select sum(sum_amoun_pay) as sum_amoun_P_p,paydate,contract_id,doc_number,status,kod,customer_id from 
(

select co.id, co.doc_number, (select caption from DISPSTATUS where co.DISPSTATUS_ID=id) as status, (select code from CONTRACTREASON where id=co.SINGLECUSTOMERREASON_ID)as kod 
,customer_id from contractdoc co
JOIN BUDGET bydget
 ON co.BUDGET_ID = bydget.Id  
  where co.id in ( select id from Inc_Out_PURCHASEMODE_CAPTION ) and document_id not in (select document_id from Inc_Out )
and document_id  in (select  document_id from Inc_Out_docflag_227)

  and bydget.caption not like '%223%'
  
  and co.DocumentClass_Id = 32  and co.dispstatus_id not in (-1,11,24,7,9) 
  and co.id in (select contract_id from CONPAYFACT where contract_id in (select id from contractdoc where id in ( select id from Inc_Out_PURCHASEMODE_CAPTION ) and document_id not in (select document_id from Inc_Out )
and document_id in (select  document_id from Inc_Out_docflag_227)

and dispstatus_id not in (-1,11,24,7,9)
) and paydate  BETWEEN ? AND ? group by paydate,contract_id)
) A join 
(
select sum(amount) as sum_amoun_pay,paydate,contract_id from CONPAYFACT where contract_id in (select id from contractdoc where id in ( select id from Inc_Out_PURCHASEMODE_CAPTION) and document_id not in (select document_id from Inc_Out )
and document_id in (select  document_id from Inc_Out_docflag_227)

and dispstatus_id not in (-1,11,24,7,9)
) and paydate  BETWEEN ? AND ?   group by paydate,contract_id
) B on A.id=B.contract_id  group by paydate,contract_id,doc_number,status,kod,customer_id ) group by  customer_id
) F on F.customer_id = C.customer_id 
 where C.customer_id in (select distinct customer_id from contractdoc where budget_id in (select id from budget where caption not like '%223%') and customer_id in (select id from  org where close_date is null and name is not null ))
 and C.customer_id not in (select id from org where description like '%автоном%' or description like '%Автоном%' or description like '%АВТОНОМ%') 
 order by costname


]]></xml-property>
        </oda-data-set>
        <oda-data-set extensionID="org.eclipse.birt.report.data.oda.jdbc.JdbcSelectDataSet" name="test1" id="1781">
            <property name="nullsOrdering">nulls lowest</property>
            <list-property name="parameters">
                <structure>
                    <property name="name">param_2</property>
                    <property name="paramName">MIN</property>
                    <property name="dataType">date</property>
                    <property name="position">1</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_3</property>
                    <property name="paramName">MAX</property>
                    <property name="dataType">date</property>
                    <property name="position">2</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_6</property>
                    <property name="paramName">MIN</property>
                    <property name="dataType">date</property>
                    <property name="position">3</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_7</property>
                    <property name="paramName">MAX</property>
                    <property name="dataType">date</property>
                    <property name="position">4</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_10</property>
                    <property name="paramName">MIN</property>
                    <property name="dataType">date</property>
                    <property name="position">5</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_11</property>
                    <property name="paramName">MAX</property>
                    <property name="dataType">date</property>
                    <property name="position">6</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_13</property>
                    <property name="paramName">MIN</property>
                    <property name="dataType">date</property>
                    <property name="position">7</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_14</property>
                    <property name="paramName">MAX</property>
                    <property name="dataType">date</property>
                    <property name="position">8</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_9</property>
                    <property name="dataType">decimal</property>
                    <property name="position">9</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_1</property>
                    <property name="paramName">MIN</property>
                    <property name="dataType">date</property>
                    <property name="position">10</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_4</property>
                    <property name="paramName">MAX</property>
                    <property name="dataType">date</property>
                    <property name="position">11</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_5</property>
                    <property name="paramName">MIN</property>
                    <property name="dataType">date</property>
                    <property name="position">12</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_8</property>
                    <property name="paramName">MAX</property>
                    <property name="dataType">date</property>
                    <property name="position">13</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">param_12</property>
                    <property name="dataType">decimal</property>
                    <property name="position">14</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
            </list-property>
            <structure name="cachedMetaData">
                <list-property name="resultSet">
                    <structure>
                        <property name="position">1</property>
                        <property name="name">CUSTOMERNAME</property>
                        <property name="dataType">string</property>
                    </structure>
                    <structure>
                        <property name="position">2</property>
                        <property name="name">ITOG_SUM_P</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">3</property>
                        <property name="name">ITOG_SUM_PO</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">4</property>
                        <property name="name">ITOG_SUMM_PP</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">5</property>
                        <property name="name">P5</property>
                        <property name="dataType">decimal</property>
                    </structure>
                    <structure>
                        <property name="position">6</property>
                        <property name="name">CUSTOMER_ID</property>
                        <property name="dataType">decimal</property>
                    </structure>
                </list-property>
            </structure>
            <property name="dataSource">Real_GZ_BELGOBL1</property>
            <list-property name="resultSet">
                <structure>
                    <property name="position">1</property>
                    <property name="name">CUSTOMERNAME</property>
                    <property name="nativeName">CUSTOMERNAME</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">2</property>
                    <property name="name">ITOG_SUM_P</property>
                    <property name="nativeName">ITOG_SUM_P</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">3</property>
                    <property name="name">ITOG_SUM_PO</property>
                    <property name="nativeName">ITOG_SUM_PO</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">4</property>
                    <property name="name">ITOG_SUMM_PP</property>
                    <property name="nativeName">ITOG_SUMM_PP</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">5</property>
                    <property name="name">P5</property>
                    <property name="nativeName">P5</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">6</property>
                    <property name="name">CUSTOMER_ID</property>
                    <property name="nativeName">CUSTOMER_ID</property>
                    <property name="dataType">decimal</property>
                </structure>
            </list-property>
            <xml-property name="queryText"><![CDATA[WITH Inc_Out AS 
(
select f.document_id from docflag f where f.docflagtype_id in (213,214,307)
),

Inc_Out_PURCHASEMODE_CAPTION AS (
  select id from contractdoc where (PURCHASEMODE_CAPTION in ('Открытый конкурс','Запрос котировок',
'Электронный аукцион','Конкурс с ограниченным участием','Двухэтапный конкурс','Запрос предложений','Открытый конкурс в электронной форме',
'Открытый конкурс с ограниченным участием в электронной форме','Двухэтапный конкурс в электронной форме','Запрос котировок в электронной форме','Запрос предложений в электронной форме')
or SINGLECUSTOMERREASON_ID in (select id from CONTRACTREASON where code in (20230,20240,20250,20260,20280,20290, 20231,20241,20251,20281,20291,20270))
)
), 

Inc_Out_docflag AS (
select f.document_id from docflag f where f.docflagtype_id in (115)
),

Inc_Out_docflag_227 AS (
select f.document_id from docflag f where f.docflagtype_id in (227)
)



select D.customername , itog_Sum_P ,   itog_Sum_PO, itog_Summ_Pp, (  100 * (itog_Sum_PO + 
(
case  when EXISTS (select * from dual where itog_Summ_Pp is null ) then 0 else itog_Summ_Pp end
)
) / itog_Sum_P ) as p5, C.customer_id  from (


select sum(sum_amoun_P) as itog_Sum_P, customer_id,customername  from (

select sum(sum_amoun_pay) as sum_amoun_P,paydate,contract_id,customername,doc_number,status,kod,customer_id from (



select sum(amount) as sum_amoun_pay,paydate,contract_id from CONPAYFACT where contract_id in (select id from contractdoc where id in (  select id from Inc_Out_PURCHASEMODE_CAPTION )  and document_id not in (select document_id from Inc_Out )
   
and dispstatus_id not in (-1,11,24,7,9) ) and paydate  BETWEEN ? AND ?   group by paydate,contract_id
) A join 

(

select co.id,co.customername, co.doc_number, (select caption from DISPSTATUS where co.DISPSTATUS_ID=id) as status, (select code from CONTRACTREASON where id=co.SINGLECUSTOMERREASON_ID)as kod 
, customer_id from contractdoc co
JOIN BUDGET bydget
 ON co.BUDGET_ID = bydget.Id  
 
 where  co.id in ( select id from Inc_Out_PURCHASEMODE_CAPTION ) and document_id not in (select document_id from Inc_Out )
  and bydget.caption not like '%223%' and co.DocumentClass_Id = 32
     and co.dispstatus_id not in (-1,11,24,7,9) 
  and co.id in (select contract_id from CONPAYFACT where contract_id in (select id from contractdoc where  id in ( select id from Inc_Out_PURCHASEMODE_CAPTION ) and document_id not in (select document_id from Inc_Out )
 
and dispstatus_id not in (-1,11,24,7,9)
) and paydate  BETWEEN ? AND ?   group by paydate,contract_id)
) B
on A.contract_id = B.id group by A.contract_id,paydate,contract_id,customername,doc_number,status,kod,customer_id ) group by customer_id,customername
) C join 
(
select sum(sum_amoun_P_o) as itog_Sum_PO, customer_id, customername from (

select sum(sum_amoun_pay) as sum_amoun_P_o,paydate,contract_id,customername,doc_number,status,kod,customer_id from 

(
select co.id,co.customername, co.doc_number, (select caption from DISPSTATUS where co.DISPSTATUS_ID=id) as status, (select code from CONTRACTREASON where id=co.SINGLECUSTOMERREASON_ID)as kod 
,customer_id from contractdoc co
JOIN BUDGET bydget
 ON co.BUDGET_ID = bydget.Id  
  where co.id in ( select id from Inc_Out_PURCHASEMODE_CAPTION) and document_id not in (select document_id from Inc_Out )
and document_id  in (select  document_id from Inc_Out_docflag)

  and bydget.caption not like '%223%'
  and co.DocumentClass_Id = 32  and co.dispstatus_id not in (-1,11,24,7,9) 
  and co.id in (select contract_id from CONPAYFACT where contract_id in (select id from contractdoc where id in ( select id from Inc_Out_PURCHASEMODE_CAPTION) and document_id not in (select document_id from Inc_Out )
and document_id in (select  document_id from Inc_Out_docflag)

and dispstatus_id not in (-1,11,24,7,9)
) and paydate  BETWEEN ? AND ? )
) A join 
(
select sum(amount) as sum_amoun_pay,paydate,contract_id from CONPAYFACT where contract_id in (select id from contractdoc where id in ( select id from Inc_Out_PURCHASEMODE_CAPTION ) and document_id not in (select document_id from Inc_Out )
and document_id in (select  document_id from Inc_Out_docflag)

and dispstatus_id not in (-1,11,24,7,9)
) and paydate  BETWEEN ? AND ?  group by paydate,contract_id
) B on A.id=B.contract_id  group by paydate,contract_id,customername,doc_number,status,kod,customer_id ) group by customer_id, customername

) D on C.customer_id = D.customer_id  and C.customername = D.customername and D.customer_id in (select c.child_id from orgchild c where c.org_id = ?) 
--------------------------------------pp--------------------------------------------------------------
left join 
(
select sum(sum_amoun_P_p) as itog_Summ_Pp, customername, customer_id from (
select sum(sum_amoun_pay) as sum_amoun_P_p,paydate,contract_id,customername,doc_number,status,kod,customer_id from 
(

select co.id,co.customername, co.doc_number, (select caption from DISPSTATUS where co.DISPSTATUS_ID=id) as status, (select code from CONTRACTREASON where id=co.SINGLECUSTOMERREASON_ID)as kod 
,customer_id from contractdoc co
JOIN BUDGET bydget
 ON co.BUDGET_ID = bydget.Id  
  where co.id in ( select id from Inc_Out_PURCHASEMODE_CAPTION ) and document_id not in (select document_id from Inc_Out )
and document_id  in (select  document_id from Inc_Out_docflag_227)

  and bydget.caption not like '%223%'
  
  and co.DocumentClass_Id = 32  and co.dispstatus_id not in (-1,11,24,7,9) 
  and co.id in (select contract_id from CONPAYFACT where contract_id in (select id from contractdoc where id in ( select id from Inc_Out_PURCHASEMODE_CAPTION ) and document_id not in (select document_id from Inc_Out )
and document_id in (select  document_id from Inc_Out_docflag_227)

and dispstatus_id not in (-1,11,24,7,9)
) and paydate  BETWEEN ? AND ? group by paydate,contract_id)
) A join 
(
select sum(amount) as sum_amoun_pay,paydate,contract_id from CONPAYFACT where contract_id in (select id from contractdoc where id in ( select id from Inc_Out_PURCHASEMODE_CAPTION) and document_id not in (select document_id from Inc_Out )
and document_id in (select  document_id from Inc_Out_docflag_227)

and dispstatus_id not in (-1,11,24,7,9)
) and paydate  BETWEEN ? AND ?   group by paydate,contract_id
) B on A.id=B.contract_id  group by paydate,contract_id,customername,doc_number,status,kod,customer_id ) group by customername, customer_id
) F on F.customer_id = D.customer_id and F.customername = D.customername and D.customer_id in (select c.child_id from orgchild c where c.org_id = ?)
 where D.customer_id in (select distinct customer_id from contractdoc where budget_id in (select id from budget where caption not like '%223%') and customer_id in (select id from  org where close_date is null and name is not null ))
   and C.customer_id not in (select id from org where description like '%автоном%' or description like '%Автоном%' or description like '%АВТОНОМ%') 
   order by D.customername



]]></xml-property>
        </oda-data-set>
    </data-sets>
    <styles>
        <style name="report" id="4">
            <property name="fontFamily">sans-serif</property>
            <property name="fontSize">10pt</property>
        </style>
        <style name="crosstab-cell" id="5">
            <property name="borderBottomColor">#CCCCCC</property>
            <property name="borderBottomStyle">solid</property>
            <property name="borderBottomWidth">1pt</property>
            <property name="borderLeftColor">#CCCCCC</property>
            <property name="borderLeftStyle">solid</property>
            <property name="borderLeftWidth">1pt</property>
            <property name="borderRightColor">#CCCCCC</property>
            <property name="borderRightStyle">solid</property>
            <property name="borderRightWidth">1pt</property>
            <property name="borderTopColor">#CCCCCC</property>
            <property name="borderTopStyle">solid</property>
            <property name="borderTopWidth">1pt</property>
        </style>
        <style name="crosstab" id="6">
            <property name="borderBottomColor">#CCCCCC</property>
            <property name="borderBottomStyle">solid</property>
            <property name="borderBottomWidth">1pt</property>
            <property name="borderLeftColor">#CCCCCC</property>
            <property name="borderLeftStyle">solid</property>
            <property name="borderLeftWidth">1pt</property>
            <property name="borderRightColor">#CCCCCC</property>
            <property name="borderRightStyle">solid</property>
            <property name="borderRightWidth">1pt</property>
            <property name="borderTopColor">#CCCCCC</property>
            <property name="borderTopStyle">solid</property>
            <property name="borderTopWidth">1pt</property>
        </style>
    </styles>
    <page-setup>
        <simple-master-page name="Simple MasterPage" id="2">
            <page-footer>
                <text id="3">
                    <property name="contentType">html</property>
                    <text-property name="content"><![CDATA[<value-of>new Date()</value-of>]]></text-property>
                </text>
            </page-footer>
        </simple-master-page>
    </page-setup>
    <body>
        <table id="1836">
            <property name="dataSet">test</property>
            <list-property name="boundDataColumns">
                <structure>
                    <property name="name">COSTNAME</property>
                    <text-property name="displayName">COSTNAME</text-property>
                    <expression name="expression" type="javascript">dataSetRow["COSTNAME"]</expression>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="name">ITOG_SUM_P</property>
                    <text-property name="displayName">ITOG_SUM_P</text-property>
                    <expression name="expression" type="javascript">dataSetRow["ITOG_SUM_P"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">ITOG_SUM_PO</property>
                    <text-property name="displayName">ITOG_SUM_PO</text-property>
                    <expression name="expression" type="javascript">dataSetRow["ITOG_SUM_PO"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">ITOG_SUMM_PP</property>
                    <text-property name="displayName">ITOG_SUMM_PP</text-property>
                    <expression name="expression" type="javascript">dataSetRow["ITOG_SUMM_PP"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">P5</property>
                    <text-property name="displayName">P5</text-property>
                    <expression name="expression" type="javascript">dataSetRow["P5"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">CUSTOMER_ID</property>
                    <text-property name="displayName">CUSTOMER_ID</text-property>
                    <expression name="expression" type="javascript">dataSetRow["CUSTOMER_ID"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
            </list-property>
            <column id="1870">
                <property name="width">2.3229166666666665in</property>
            </column>
            <column id="1871">
                <property name="width">1.3125in</property>
            </column>
            <column id="1872">
                <property name="width">1.375in</property>
            </column>
            <column id="1873">
                <property name="width">1.34375in</property>
            </column>
            <column id="1874"/>
            <header>
                <row id="1837">
                    <cell id="1838">
                        <label id="1839">
                            <text-property name="text">Наименование органа исполнительной власти, государственного органа</text-property>
                        </label>
                    </cell>
                    <cell id="1840">
                        <label id="1841">
                            <text-property name="text">Совокупный годовой объем закупок, рассчитанный за вычетом закупок, предусмотренных частью 1.1 статьи 30 Федерального закона (тыс. рублей)</text-property>
                        </label>
                    </cell>
                    <cell id="1842">
                        <label id="1843">
                            <text-property name="text">Объем закупок в отчетном году, осуществленных по результатам процедур определения поставщика (подрядчика, исполнителя), в извещении об осуществлении которых было установлено ограничение в отношении участников закупок, которыми могли быть только СМП и СОНО                           (тыс. рублей)</text-property>
                        </label>
                    </cell>
                    <cell id="1844">
                        <label id="1845">
                            <text-property name="text">Объем привлечения в отчетном году субподрядчиков и соисполнителей из числа СМП и СОНО к исполнению контрактов, заключенных по результатам определений поставщиков (подрядчиков, исполнителей), в извещениях об осуществлении которых было установлено требование к поставщику (подрядчику, исполнителю), не являющемуся СМП или СОНО, о привлечении к исполнению контракта субподрядчиков (соисполнителей) из числа СМП и СОНО (тыс. рублей)</text-property>
                        </label>
                    </cell>
                    <cell id="1846">
                        <label id="1847">
                            <text-property name="text">Доля закупок, которые заказчик осуществил у СМП и СОНО в отчетном году, в совокупном годовом объеме закупок, за исключением объема закупок, сведения о которых составляют государственную тайну и за вычетом закупок, предусмотренных частью 1.1 статьи 30 Федерального закона (процент)</text-property>
                        </label>
                    </cell>
                </row>
            </header>
            <detail>
                <row id="1850">
                    <property name="height">1.2083333333333333in</property>
                    <cell id="1851">
                        <data id="1852">
                            <property name="resultSetColumn">COSTNAME</property>
                        </data>
                    </cell>
                    <cell id="1853">
                        <data id="1854">
                            <structure name="numberFormat">
                                <property name="category">Fixed</property>
                                <property name="pattern">###0.00{RoundingMode=HALF_UP}</property>
                            </structure>
                            <property name="resultSetColumn">ITOG_SUM_P</property>
                        </data>
                    </cell>
                    <cell id="1855">
                        <data id="1856">
                            <structure name="numberFormat">
                                <property name="category">Fixed</property>
                                <property name="pattern">###0.00{RoundingMode=HALF_UP}</property>
                            </structure>
                            <property name="resultSetColumn">ITOG_SUM_PO</property>
                        </data>
                    </cell>
                    <cell id="1857">
                        <data id="1858">
                            <structure name="numberFormat">
                                <property name="category">Fixed</property>
                                <property name="pattern">###0.00{RoundingMode=HALF_UP}</property>
                            </structure>
                            <property name="resultSetColumn">ITOG_SUMM_PP</property>
                        </data>
                    </cell>
                    <cell id="1859">
                        <data id="1860">
                            <structure name="numberFormat">
                                <property name="category">Fixed</property>
                                <property name="pattern">###0.00{RoundingMode=HALF_UP}</property>
                            </structure>
                            <property name="resultSetColumn">P5</property>
                        </data>
                    </cell>
                </row>
            </detail>
            <footer>
                <row id="1863">
                    <cell id="1864"/>
                    <cell id="1865"/>
                    <cell id="1866"/>
                    <cell id="1867"/>
                    <cell id="1868"/>
                </row>
            </footer>
        </table>
    </body>
</report>
